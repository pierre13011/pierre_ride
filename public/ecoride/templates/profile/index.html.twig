{% extends 'layout.html.twig' %}

{% block title %}Mon Profil{% endblock %}

{% block content %}
<div class="container my-5" style="max-width:600px">
    <h2 class="mb-4">Mon profil</h2>

    <p><strong>Nom :</strong> {{ app.user.nom }}</p>
    <p><strong>PrÃ©nom :</strong> {{ app.user.prenom }}</p>
    <p><strong>Pseudo :</strong> {{ app.user.pseudo }}</p>
    <p><strong>Email :</strong> {{ app.user.email }}</p>

    <p><strong>RÃ´le(s) :</strong>
        {% for role in app.user.roles %}
            {% if role == 'ROLE_USER' %}
                <span class="badge bg-secondary">Utilisateur</span>
            {% elseif role == 'ROLE_CHAUFFEUR' %}
                <span class="badge bg-success">Chauffeur</span>
            {% endif %}
        {% endfor %}
    </p>

    <hr class="my-4">

    {# â–¼ Si l'utilisateur n'est PAS chauffeur â–¼ #}
    {% if not ('ROLE_CHAUFFEUR' in app.user.roles) %}
        <a href="{{ path('app_devenir_chauffeur') }}" class="btn btn-success mt-3">
            ðŸš— Devenir Chauffeur
        </a>
    {% else %}
        {# â–¼ Si l'utilisateur EST chauffeur â–¼ #}
        <div class="alert alert-success">
            âœ” Vous Ãªtes chauffeur
        </div>

        <a href="{{ path('app_chauffeur_espace') }}" class="btn btn-primary">
            AccÃ©der Ã  lâ€™espace Chauffeur
        </a>

        <a href="{{ path('app_chauffeur_trajet_new') }}" class="btn btn-success mt-3">
            âž• Proposer un trajet
        </a>
    {% endif %}

    {# â–¼ Section visible uniquement pour les chauffeurs â–¼ #}
    {% if 'ROLE_CHAUFFEUR' in app.user.roles %}
        <h3 class="mt-5">Mes trajets proposÃ©s</h3>
        <hr>

        {% if app.user.trajets is empty %}
            <p class="text-muted">Aucun trajet proposÃ© pour l'instant.</p>
        {% else %}
            <div class="list-group">
                {% for trajet in app.user.trajets %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ trajet.depart }} â†’ {{ trajet.arrivee }}</strong><br>
                            Date : {{ trajet.date|date('d/m/Y') }} â€” 
                            Heure : {{ trajet.heure|date('H:i') }}<br>
                            Prix : {{ trajet.prix }} â‚¬ â€” 
                            Places restantes : {{ trajet.getPlacesRestantes() }}
                        </div>

                        <a href="{{ path('chauffeur_trajet_reservations', { id: trajet.id }) }}"
                           class="btn btn-dark btn-sm">
                            Voir rÃ©servations
                        </a>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endif %}
</div>
{% endblock %}
